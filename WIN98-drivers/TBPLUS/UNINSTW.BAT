@ECHO OFF

SET D1=%1
IF "%D1%"=="" SET D1=%WINDIR%
IF "%D1%"=="" GOTO NOARG

IF NOT EXIST %D1%\SYSTEM\IOSUBSYS\ESDI_506.PDR GOTO BADPATH

IF NOT EXIST %D1%\SYSTEM\IOSUBSYS\ESDI_506.BAK GOTO INST
IF NOT EXIST %D1%\SYSTEM\IOSUBSYS\DISKTSD.BAK GOTO INST
IF NOT EXIST %D1%\SYSTEM\IOSUBSYS\DISKVSD.BAK GOTO INST

IF NOT EXIST %D1%\SYSTEM\IOSUBSYS\ESDI_506.PDR GOTO MISSING
IF NOT EXIST %D1%\SYSTEM\IOSUBSYS\DISKTSD.VXD GOTO MISSING
IF NOT EXIST %D1%\SYSTEM\IOSUBSYS\DISKVSD.VXD GOTO MISSING
IF NOT EXIST %D1%\SYSTEM\VMM32\IOS.VXD GOTO MISSING
IF NOT EXIST %D1%\SYSTEM\VMM32\VFAT.VXD GOTO MISSING
IF NOT EXIST %D1%\INF\SATA.INF GOTO MISSING
IF NOT EXIST %D1%\INF\ATA0106.INF GOTO MISSING
IF NOT EXIST %D1%\INF\ATA0180.INF GOTO MISSING

DEL %D1%\SYSTEM\IOSUBSYS\ESDI_506.PDR
DEL %D1%\SYSTEM\IOSUBSYS\DISKTSD.VXD
DEL %D1%\SYSTEM\IOSUBSYS\DISKVSD.VXD
DEL %D1%\SYSTEM\VMM32\IOS.VXD
DEL %D1%\SYSTEM\VMM32\VFAT.VXD
DEL %D1%\INF\SATA.INF
DEL %D1%\INF\ATA0104.INF
DEL %D1%\INF\ATA0104A.INF
DEL %D1%\INF\ATA0106.INF
DEL %D1%\INF\ATA0180.INF

REN %D1%\SYSTEM\IOSUBSYS\ESDI_506.BAK ESDI_506.PDR
REN %D1%\SYSTEM\IOSUBSYS\DISKTSD.BAK DISKTSD.VXD
REN %D1%\SYSTEM\IOSUBSYS\DISKVSD.BAK DISKVSD.VXD
IF EXIST %D1%\SYSTEM\VMM32\IOS.BAK REN %D1%\SYSTEM\VMM32\IOS.BAK IOS.VXD
IF EXIST %D1%\SYSTEM\VMM32\VFAT.BAK REN %D1%\SYSTEM\VMM32\VFAT.BAK VFAT.VXD

ECHO TBPLUS WINDOWS PATCHES REMOVED SUCCESSFULLY
GOTO EXIT

:INST
IF EXIST %D1%\SYSTEM\IOSUBSYS\ESDI_506.BAK GOTO MOD
IF EXIST %D1%\SYSTEM\IOSUBSYS\DISKTSD.BAK GOTO MOD
IF EXIST %D1%\SYSTEM\IOSUBSYS\DISKVSD.BAK GOTO MOD
IF EXIST %D1%\SYSTEM\VMM32\IOS.BAK GOTO MOD
IF EXIST %D1%\SYSTEM\VMM32\VFAT.BAK GOTO MOD
ECHO TBPLUS WINDOWS PATCHES NOT APPLIED - RUN INSTALLW TO INSTALL
GOTO EXIT
:MOD
ECHO ONE OR MORE FILES NOT PATCHED - UNINSTALL MANUALLY
GOTO EXIT
:MISSING
ECHO FILES MISSING OR WINDOWS DAMAGED
GOTO EXIT
:BADPATH
ECHO WINDOWS PATH INCORRECT OR WINDOWS DAMAGED
GOTO EXIT
:NOARG
ECHO WINDOWS DIRECTORY PATH MUST BE SPECIFIED
:EXIT
@ECHO ON
